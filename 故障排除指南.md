# 故障排除指南

## 目录

1. [模型下载问题](#模型下载问题)
2. [应用启动问题](#应用启动问题)
3. [文档上传问题](#文档上传问题)
4. [检索问题](#检索问题)
5. [性能问题](#性能问题)

---

## 模型下载问题

### 症状：嵌入模型加载失败

```
嵌入模型加载失败: TypeError: fetch failed
Error: read ECONNRESET
```

### 诊断步骤

1. **测试网络连接**
   ```bash
   双击运行 "测试网络连接.bat"
   ```

2. **查看详细日志**
   - 打开应用
   - 按 F12 打开开发者工具
   - 查看 Console 标签页

### 解决方案

#### 方案 A：配置镜像源（推荐）

**适用场景**：中国大陆用户，网络无法访问 Hugging Face

**步骤**：
1. 运行 `配置镜像源.bat`
2. 选择 "1. hf-mirror.com"
3. 重启应用
4. 重新尝试上传文档

**验证**：
```bash
# 检查 .env 文件
type .env | findstr HUGGINGFACE_MIRROR
```

应该看到：
```
HUGGINGFACE_MIRROR=https://hf-mirror.com
```

#### 方案 B：配置代理

**适用场景**：有可用的代理服务器

**步骤**：
1. 打开 `.env` 文件
2. 添加以下内容：
   ```env
   HTTP_PROXY=http://127.0.0.1:7890
   HTTPS_PROXY=http://127.0.0.1:7890
   ```
3. 修改端口号为你的代理端口
4. 保存文件
5. 重启应用

**验证**：
```bash
# 检查代理是否生效
echo %HTTP_PROXY%
```

#### 方案 C：手动下载模型

**适用场景**：自动下载多次失败

**步骤**：

1. 创建目录结构：
   ```bash
   mkdir .cache\models\Xenova\all-MiniLM-L6-v2\onnx
   ```

2. 下载文件（使用浏览器或下载工具）：
   
   从 https://hf-mirror.com/Xenova/all-MiniLM-L6-v2 下载：
   - `config.json`
   - `tokenizer.json`
   - `tokenizer_config.json`
   - `onnx/model.onnx`
   - `onnx/model_quantized.onnx`

3. 将文件放到对应目录：
   ```
   .cache/
   └── models/
       └── Xenova/
           └── all-MiniLM-L6-v2/
               ├── config.json
               ├── tokenizer.json
               ├── tokenizer_config.json
               └── onnx/
                   ├── model.onnx
                   └── model_quantized.onnx
   ```

4. 重启应用

**验证**：
```bash
# 检查文件是否存在
dir .cache\models\Xenova\all-MiniLM-L6-v2
```

#### 方案 D：等待自动重试

**适用场景**：网络不稳定但可以连接

**说明**：
- 系统会自动重试 3 次
- 重试间隔：2秒、4秒、6秒
- 每次重试会显示进度

**步骤**：
1. 保持应用运行
2. 等待自动重试完成
3. 如果失败，关闭应用
4. 等待 1-2 分钟
5. 重新启动应用

### 预防措施

1. **首次使用前配置**
   - 在上传文档前先配置镜像源
   - 确保网络连接稳定

2. **定期检查**
   - 运行 `测试网络连接.bat`
   - 确保配置正确

---

## 应用启动问题

### 症状：应用无法启动或立即崩溃

### 诊断步骤

1. **检查 Node.js 版本**
   ```bash
   node --version
   ```
   要求：v16.0.0 或更高

2. **检查依赖安装**
   ```bash
   dir node_modules
   ```

3. **查看错误日志**
   - 查看控制台输出
   - 检查 `npminstall-debug.log`

### 解决方案

#### 问题：Node.js 版本过低

**解决**：
1. 访问 https://nodejs.org/
2. 下载并安装最新 LTS 版本
3. 重启命令行
4. 验证版本：`node --version`

#### 问题：依赖未安装或损坏

**解决**：
```bash
# 清理缓存
npm cache clean --force

# 删除 node_modules
rmdir /s /q node_modules

# 重新安装
npm install

# 重新构建
npm run build
```

#### 问题：端口被占用

**症状**：
```
Error: listen EADDRINUSE: address already in use :::3000
```

**解决**：
```bash
# 查找占用端口的进程
netstat -ano | findstr :3000

# 结束进程（替换 PID）
taskkill /PID <进程ID> /F
```

---

## 文档上传问题

### 症状：文档上传失败

### 诊断步骤

1. **检查文件格式**
   - 支持：PDF, TXT, MD, DOCX
   - 不支持：图片、视频、压缩包

2. **检查文件大小**
   - 建议：< 10MB
   - 最大：50MB

3. **查看错误信息**
   - 打开开发者工具（F12）
   - 查看 Console 标签页

### 解决方案

#### 问题：文件格式不支持

**解决**：
1. 转换文件格式
   - Word → PDF
   - 图片 → OCR 提取文字
2. 或等待后续版本支持

#### 问题：文件过大

**解决**：
1. 分割文件
2. 压缩文件（减少图片质量）
3. 提取纯文本内容

#### 问题：文件编码问题

**症状**：
- 中文显示乱码
- 特殊字符丢失

**解决**：
1. 确保文件使用 UTF-8 编码
2. 使用文本编辑器转换编码
3. 重新保存文件

---

## 检索问题

### 症状：检索结果不相关或无结果

### 诊断步骤

1. **检查文档是否上传成功**
   - 打开文档库
   - 确认文档列表中有文档

2. **检查问题表述**
   - 是否包含关键词
   - 是否足够具体

3. **检查向量数据库**
   ```bash
   dir data\vectors.db
   ```

### 解决方案

#### 问题：检索无结果

**可能原因**：
- 文档未包含相关内容
- 问题表述不清

**解决**：
1. 使用文档中的关键词
2. 尝试不同的表述方式
3. 检查文档内容是否正确

#### 问题：检索结果不准确

**可能原因**：
- 相似度阈值过低
- 文档质量问题

**解决**：
1. 使用更具体的问题
2. 上传高质量文档
3. 清理重复或无关文档

#### 问题：检索速度慢

**可能原因**：
- 文档数量过多
- 向量数据库过大

**解决**：
1. 定期清理不需要的文档
2. 优化文档分块大小
3. 考虑升级硬件

---

## 性能问题

### 症状：应用运行缓慢

### 诊断步骤

1. **检查系统资源**
   - 打开任务管理器
   - 查看 CPU、内存使用率

2. **检查数据库大小**
   ```bash
   dir data
   ```

3. **检查缓存大小**
   ```bash
   dir .cache
   ```

### 解决方案

#### 问题：内存占用过高

**解决**：
1. 关闭其他应用
2. 减少同时处理的文档数量
3. 重启应用

#### 问题：磁盘空间不足

**解决**：
1. 清理缓存：
   ```bash
   rmdir /s /q .cache
   ```
2. 删除不需要的文档
3. 清理数据库

#### 问题：响应速度慢

**解决**：
1. 优化文档数量
2. 使用更快的存储设备（SSD）
3. 升级硬件配置

---

## 常用命令

### 重置应用

```bash
# 清理所有数据
rmdir /s /q data
rmdir /s /q .cache
rmdir /s /q node_modules

# 重新安装
npm install
npm run build
```

### 查看日志

```bash
# 启动应用并查看日志
npm start
```

### 测试构建

```bash
# 测试构建是否成功
npm run build
```

### 开发模式

```bash
# 启动开发模式（热重载）
npm run dev
```

---

## 获取帮助

如果以上方法都无法解决问题：

1. **查看文档**
   - [RAG功能使用指南](./RAG功能使用指南.md)
   - [模型下载问题解决方案](./模型下载问题解决方案.md)

2. **收集信息**
   - 错误信息截图
   - 控制台日志
   - 系统信息（操作系统、Node.js 版本）

3. **提交 Issue**
   - 访问 GitHub 仓库
   - 创建新 Issue
   - 提供详细信息

4. **社区支持**
   - 查看已有 Issue
   - 参与讨论
   - 分享经验

---

## 预防性维护

### 定期任务

1. **每周**
   - 清理不需要的文档
   - 检查磁盘空间

2. **每月**
   - 更新依赖：`npm update`
   - 清理缓存：`npm cache clean --force`

3. **每季度**
   - 备份数据库
   - 检查应用更新

### 最佳实践

1. **文档管理**
   - 按主题组织文档
   - 定期清理过期文档
   - 避免重复上传

2. **性能优化**
   - 控制文档数量（< 100 个）
   - 单个文档大小（< 10MB）
   - 定期重启应用

3. **安全性**
   - 不上传敏感信息
   - 定期备份数据
   - 保护 API 密钥

---

## 附录

### 系统要求

- **操作系统**：Windows 10/11, macOS 10.15+, Linux
- **Node.js**：v16.0.0+
- **内存**：4GB+（推荐 8GB+）
- **磁盘空间**：2GB+
- **网络**：稳定的互联网连接

### 文件位置

- **配置文件**：`.env`
- **数据库**：`./data/`
- **缓存**：`./.cache/`
- **日志**：控制台输出

### 相关链接

- [Hugging Face](https://huggingface.co/)
- [HF Mirror](https://hf-mirror.com/)
- [Node.js](https://nodejs.org/)
- [Electron](https://www.electronjs.org/)

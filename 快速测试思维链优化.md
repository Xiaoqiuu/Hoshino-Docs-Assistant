# 快速测试思维链优化

## 测试准备

### 1. 配置推理模型

**云端模式：**
```
设置 → 云端模型 → deepseek-reasoner
设置 → 输出设置 → ✓ 启用流式输出
设置 → 输出设置 → ✓ 显示思维链内容
```

**本地模式：**
```bash
# 下载模型
ollama pull deepseek-r1:7b

# 配置
设置 → ✓ 使用本地模型（Ollama）
设置 → 本地模型 → deepseek-r1:7b
设置 → 输出设置 → ✓ 启用流式输出
设置 → 输出设置 → ✓ 显示思维链内容
```

## 测试用例

### 测试 1：基本思维链展示

**输入：**
```
9.11 和 9.8 哪个更大？
```

**预期行为：**
1. ✅ 显示 "正在思考..." 或空消息框
2. ✅ 思维链面板自动展开
3. ✅ 显示 "🧠 思维过程 (思考中...)"
4. ✅ 实时显示思考内容
5. ✅ 收到正式回复后：
   - 隐藏 "(思考中...)"
   - 自动折叠思维链
   - 显示最终答案
6. ✅ 可以手动点击展开查看完整思维过程

### 测试 2：复杂推理

**输入：**
```
单词 'strawberry' 中有多少个字母 'r'？
```

**预期行为：**
1. ✅ 思维链自动展开
2. ✅ 显示详细的推理过程
3. ✅ 思考完成后自动折叠
4. ✅ 显示正确答案（3个）

### 测试 3：数学推理

**输入：**
```
如果一个长方形的长是 12.5 米，宽是 8.3 米，求面积和周长。
```

**预期行为：**
1. ✅ 展开思维链显示计算过程
2. ✅ 自动折叠后显示结果
3. ✅ 结果准确

### 测试 4：逻辑推理

**输入：**
```
所有的猫都怕水，Tom 是一只猫，那么 Tom 怕水吗？
```

**预期行为：**
1. ✅ 显示逻辑推理步骤
2. ✅ 自动展开 → 自动折叠
3. ✅ 给出正确结论

## 检查点

### ✅ 状态管理
- [ ] 思考阶段显示 "(思考中...)"
- [ ] 收到正式回复后隐藏 "(思考中...)"
- [ ] 状态切换流畅无卡顿

### ✅ 自动展开/折叠
- [ ] 思考阶段自动展开
- [ ] 收到正式回复时自动折叠
- [ ] 可以手动展开/折叠

### ✅ 内容分离
- [ ] 思维链和正式回复分开显示
- [ ] 思维链在上方，回复在下方
- [ ] 内容不会混淆

### ✅ 流式显示
- [ ] 思维链逐字显示
- [ ] 正式回复逐字显示
- [ ] 显示流畅

### ✅ UI 效果
- [ ] 思考指示器有动画效果
- [ ] 思维链面板样式正确
- [ ] 折叠/展开动画流畅

## 观察要点

### 1. 时序正确性
```
思考阶段：
  ├─ 展开思维链
  ├─ 显示 "(思考中...)"
  └─ 实时更新思考内容

回复阶段：
  ├─ 隐藏 "(思考中...)"
  ├─ 折叠思维链
  └─ 显示正式回复
```

### 2. 状态一致性
- 思考时：`isThinking: true`, `reasoningExpanded: true`
- 回复时：`isThinking: false`, `reasoningExpanded: false`

### 3. 内容完整性
- 思维链内容完整保存
- 正式回复内容完整保存
- 两者互不影响

## 常见问题

### Q1: 思维链没有自动展开

**检查：**
```javascript
// 在控制台查看消息状态
console.log(messages[messages.length - 1]);
// 应该看到 reasoningExpanded: true
```

**解决：**
- 确认启用了流式输出
- 确认启用了显示思维链
- 重启应用

### Q2: 思维链没有自动折叠

**检查：**
```javascript
// 查看是否收到了 content
console.log('Has content:', messages[messages.length - 1].content);
```

**解决：**
- 确认模型有正式回复
- 检查网络连接
- 查看控制台错误

### Q3: 显示"思考中..."但没有内容

**原因：**
- 网络延迟
- 模型处理中

**解决：**
- 等待几秒
- 检查网络
- 查看 API 状态

## 调试技巧

### 1. 查看消息状态

```javascript
// 在渲染进程控制台
window.addEventListener('keydown', (e) => {
  if (e.key === 'F9') {
    console.log('Messages:', messages);
  }
});
```

### 2. 监听流式事件

```javascript
// 在 App.tsx 中添加日志
const handleStreamChunk = (data) => {
  console.log('Stream chunk:', data);
  // ... 原有逻辑
};
```

### 3. 检查配置

```javascript
// 查看当前配置
window.electronAPI.getConfig().then(config => {
  console.log('Config:', config);
});
```

## 性能测试

### 测试长思维链

**输入：**
```
请详细解释量子计算的原理，包括量子比特、量子叠加、量子纠缠等概念。
```

**观察：**
- 思维链长度
- 滚动性能
- 内存占用
- 渲染流畅度

### 测试快速切换

**操作：**
1. 发送问题
2. 在思考阶段快速展开/折叠
3. 在回复阶段快速展开/折叠

**预期：**
- 无卡顿
- 状态正确
- 内容完整

## 成功标准

### ✅ 功能完整
- [x] 思维链和回复分开存储
- [x] 状态管理正确
- [x] 自动展开/折叠工作

### ✅ 交互流畅
- [x] 展开/折叠动画流畅
- [x] 流式显示无卡顿
- [x] 状态切换及时

### ✅ 用户体验
- [x] 符合用户预期
- [x] 视觉反馈清晰
- [x] 操作简单直观

## 报告问题

如果发现问题，请记录：

1. **问题描述**
   - 具体现象
   - 预期行为
   - 实际行为

2. **重现步骤**
   - 详细操作步骤
   - 使用的模型
   - 输入的问题

3. **环境信息**
   - 操作系统
   - 应用版本
   - 配置信息

4. **截图/录屏**
   - 问题截图
   - 控制台日志
   - 网络请求

## 下一步

测试通过后：
1. ✅ 体验不同类型的推理问题
2. ✅ 尝试调整配置选项
3. ✅ 探索思维链的其他用途
4. ✅ 提供反馈和建议
